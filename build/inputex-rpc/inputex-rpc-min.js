YUI.add("inputex-rpc",function(e,t){YUI.add("inputex-rpc",function(e){var t=e.Lang,n=e.inputEx;n.RPC={generateServiceForm:function(r,i,s){var o=null;t.isObject(i)&&t.isArray(i.fields)?o=i:(o=n.RPC.formForMethod(r),e.mix(o,i,!0));var u=r._methodName||r.name;o.type="form",o.buttons||(o.buttons=[{type:"submit",value:u,onClick:function(){return a.showMask(),r(a.getValue(),{success:function(e){a.hideMask(),t.isObject(s)&&t.isFunction(s.success)&&s.success.call(s.scope||this,e)},failure:function(){a.hideMask()}}),!1}}]);var a=n(o);return a},formForMethod:function(e){var t={},r=e._methodName||e.name;t[r]={id:r,type:"object",properties:{}};for(var i=0;i<e._parameters.length;i++){var s=e._parameters[i];t[r].properties[s.name]=s}var o=new n.JsonSchema.Builder({schemaIdentifierMap:t,defaultOptions:{showMsg:!0}}),u=o.schemaToInputEx(t[r]);return u}};var r=n.RPC;n.RPC.Service=function(e,n){if(t.isString(e))this.smdUrl=e,this.fetch(e,n);else{if(!t.isObject(e))throw new Error("smd should be an object or an url");this._smd=e,this.process(n)}},n.RPC.Service.prototype={_generateService:function(n,i){if(this[i])throw new Error("WARNING: "+n+" already exists for service. Unable to generate function");i.name=n,i._methodName=n;var s=this,o=function(n,o){var u=r.Envelope[i.envelope||s._smd.envelope],a={success:function(e){var t=u.deserialize(e);o.success.call(o.scope||s,t)},failure:function(e){if(t.isFunction(o.failure)){var n=u.deserialize(e);o.failure.call(o.scope||s,n)}},scope:s},f={};if(s._smd.additionalParameters&&t.isArray(s._smd.parameters))for(var l=0;l<s._smd.parameters.length;l++){var c=s._smd.parameters[l];f[c.name]=c["default"]}e.mix(f,n,!0);var h=i.target||s._smd.target,p=/^(http|https):\/\/[a-z0-9]+([\-\.]{1}[a-z0-9]+)*\.[a-z]{2,5}(([0-9]{1,5})?\/.*)?$/i;!h.match(p)&&h!=s._smd.target&&(h=s._smd.target+h);if(!!this.smdUrl&&!h.match(p)){var d=this.smdUrl.split("/");d[d.length-1]="",h=d.join("/")+h}var v={target:h,callback:a,data:f,origData:n,opts:o,callbackParamName:i.callbackParamName||s._smd.callbackParamName,transport:i.transport||s._smd.transport},m=u.serialize(s._smd,i,f);e.mix(v,m,!0),r.Transport[v.transport].call(s,v)};return o.name=n,o._methodName=n,o.description=i.description,o._parameters=i.parameters,o},process:function(e){var n=this._smd.services;for(var r in n)if(n.hasOwnProperty(r)){var i=this,s=r.split(".");for(var o=0;o<s.length-1;o++)i=i[s[o]]||(i[s[o]]={});i[s[s.length-1]]=this._generateService(r,n[r])}t.isObject(e)&&t.isFunction(e.success)&&e.success.call(e.scope||this)},fetch:function(n,r){var i={method:"GET",on:{success:function(n,i){try{this._smd=e.JSON.parse(i.responseText),this.process(r)}catch(s){t.isObject(console)&&t.isFunction(console.log)&&console.log(s),t.isFunction(r.failure)&&r.failure.call(r.scope||this,{error:s})}},failure:function(e,i){t.isFunction(r.failure)&&r.failure.call(r.scope||this,{error:"unable to fetch url "+n})}},context:this};e.io(n,i)}},n.RPC.Service._requestId=1,n.RPC.Transport={POST:function(t){return e.io(t.target,{method:"POST",on:{succes:t.callback},data:t.data})},GET:function(t){return e.io(t.target+(t.data?"?"+t.data:""),{method:"GET",on:{success:t.callback}})},REST:function(e){},JSONP:function(n){var r=n.target+(n.target.indexOf("?")==-1?"?":"&")+n.data+"&"+n.callbackParamName+"={callback}";e.jsonp(r,function(e){t.isObject(n.callback)&&t.isFunction(n.callback.success)&&n.callback.success.call(n.callback.scope||this,e)})},"TCP/IP":function(e){throw new Error("TCP/IP transport not implemented !")}},n.RPC.Envelope={URL:{serialize:function(e,n,r){var i=encodeURIComponent,s=[];for(var o in r)if(r.hasOwnProperty(o)){var u=r[o];if(t.isArray(u))for(var a=0;a<u.length;a++)s.push(i(o)+"="+i(u[a]));else s.push(i(o)+"="+i(u))}return{data:s.join("&")}},deserialize:function(e){return e}},PATH:{serialize:function(e,n,r){var i=n.target||e.target,s;if(t.isArray(r))for(s=0;s<r.length;s++)i+="/"+r[s];else for(s in r)r.hasOwnProperty(s)&&(i+="/"+s+"/"+r[s]);return{data:"",target:i}},deserialize:function(e){return e}},JSON:{serialize:function(t,n,r){return{data:e.JSON.stringify(r)}},deserialize:function(e){return e}},"JSON-RPC-1.0":{serialize:function(t,n,i){var s=n.name||n._methodName;return{data:e.JSON.stringify({id:r.Service._requestId++,method:s,params:i})}},deserialize:function(t){return e.JSON.parse(t.responseText)}},"JSON-RPC-2.0":{serialize:function(t,n,i){var s=n.name||n._methodName;return{data:e.JSON.stringify({id:r.Service._requestId++,method:s,version:"json-rpc-2.0",params:i})}},deserialize:function(t){return e.JSON.parse(t.responseText)}}}},"3.1.0",{requires:["json","inputex","io","inputex-jsonschema","jsonp"]})},"@VERSION@");
