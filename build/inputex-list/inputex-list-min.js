YUI.add("inputex-list",function(e,t){YUI.add("inputex-list",function(e){var t=e.Lang,n=e.inputEx;n.ListField=function(e){this.subFields=[],n.ListField.superclass.constructor.call(this,e)},e.extend(n.ListField,n.Field,{arrowAnimColors:{from:"#eeee33",to:"#eeeeee"},setOptions:function(e){n.ListField.superclass.setOptions.call(this,e),this.options.className=e.className?e.className:"inputEx-Field inputEx-ListField",this.options.sortable=t.isUndefined(e.sortable)?!1:e.sortable,this.options.elementType=e.elementType||{type:"string"},this.options.useButtons=t.isUndefined(e.useButtons)?!1:e.useButtons,this.options.unique=t.isUndefined(e.unique)?!1:e.unique,this.options.listAddLabel=e.listAddLabel||n.messages.listAddLink,this.options.listRemoveLabel=e.listRemoveLabel||n.messages.listRemoveLink,this.options.maxItems=e.maxItems,this.options.minItems=e.minItems},renderComponent:function(){this.options.useButtons&&(this.addButton=n.cn("img",{src:n.spacerUrl,className:"inputEx-ListField-addButton"}),this.fieldContainer.appendChild(this.addButton)),this.fieldContainer.appendChild(n.cn("span",null,{marginLeft:"4px"},this.options.listLabel)),this.childContainer=n.cn("div",{className:"inputEx-ListField-childContainer"}),this.fieldContainer.appendChild(this.childContainer),this.options.useButtons||(this.addButton=n.cn("a",{className:"inputEx-List-link"},null,this.options.listAddLabel),this.fieldContainer.appendChild(this.addButton))},initEvents:function(){e.one(this.addButton).on("click",this.onAddButton,this,!0)},validate:function(){var e=!0,r={},i=this.subFields.length;t.isNumber(this.options.minItems)&&i<this.options.minItems&&(e=!1),t.isNumber(this.options.maxItems)&&i>this.options.maxItems&&(e=!1);for(var s=0;s<i&&e;s++){var o=this.subFields[s],u=o.getState();o.setClassFromState(u);if(u==n.stateRequired||u==n.stateInvalid)e=!1;if(this.options.unique){var a=t.dump(o.getValue());r[a]?e=!1:r[a]=!0}}return e},setValue:function(e,r){if(!t.isArray(e))throw new Error("inputEx.ListField.setValue expected an array, got "+typeof e);for(var i=0;i<e.length;i++)i==this.subFields.length?this.addElement(e[i]):this.subFields[i].setValue(e[i],!1);var s=this.subFields.length-e.length;if(s>0)for(i=0;i<s;i++)this.removeElement(e.length);n.ListField.superclass.setValue.call(this,e,r)},getValue:function(){var e=[];for(var t=0;t<this.subFields.length;t++)e[t]=this.subFields[t].getValue();return e},addElement:function(e){var t=this.renderSubField(e);return this.options.name&&t.setFieldName(this.options.name+"["+this.subFields.length+"]"),this.subFields.push(t),t},resetAllNames:function(){if(this.options.name)for(var e=0;e<this.subFields.length;e++){var t=this.subFields[e];t.setFieldName(this.options.name+"["+e+"]")}},onAddButton:function(e){e.halt();if(t.isNumber(this.options.maxItems)&&this.subFields.length>=this.options.maxItems)return;var n=this.addElement();n.focus(),this.fireUpdatedEvt()},renderSubField:function(r){var i=n.cn("div"),s;this.options.useButtons&&(s=n.cn("img",{src:n.spacerUrl,className:"inputEx-ListField-delButton"}),e.one(s).on("click",this.onDelete,this),i.appendChild(s));var o=e.merge({},this.options.elementType);t.isUndefined(r)||(o.value=r);var u=n(o,this),a=u.getEl();e.one(a).addClass("inputEx-ListField-subFieldEl"),i.appendChild(a),u.on("updated",this.onChange,this,!0);if(this.options.sortable){var f=n.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowUp"});e.one(f).on("click",this.onArrowUp,this);var l=n.cn("div",{className:"inputEx-ListField-Arrow inputEx-ListField-ArrowDown"});e.one(l).on("click",this.onArrowDown,this,!0),i.appendChild(f),i.appendChild(l)}return this.options.useButtons||(s=n.cn("a",{className:"inputEx-List-link"},null,this.options.listRemoveLabel),e.one(s).on("click",this.onDelete,this),i.appendChild(s)),i.appendChild(n.cn("div",null,{clear:"both"})),this.childContainer.appendChild(i),u},onArrowUp:function(t){var n=t.target._node.parentNode,r=null,i=-1;for(var s=1;s<n.parentNode.childNodes.length;s++){var o=n.parentNode.childNodes[s];if(o==n){r=n.parentNode.childNodes[s-1],i=s;break}}if(r){var u=this.childContainer.removeChild(n),a=this.childContainer.insertBefore(u,r),f=this.subFields[i];this.subFields[i]=this.subFields[i-1],this.subFields[i-1]=f,this.resetAllNames(),this.arrowAnim&&this.arrowAnim.stop(!0),this.arrowAnim=new e.Anim({node:a,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:.4}),this.arrowAnim.on("end",function(){e.one(a).setStyle("backgroundColor","")}),this.arrowAnim.run(),this.fireUpdatedEvt()}},onArrowDown:function(t){var n=t.target._node.parentNode,r=-1,i=null;for(var s=0;s<n.parentNode.childNodes.length;s++){var o=n.parentNode.childNodes[s];if(o==n){i=n.parentNode.childNodes[s+1],r=s;break}}if(i){var u=this.childContainer.removeChild(n),a=e.one(i).insert(u,"after"),f=this.subFields[r];this.subFields[r]=this.subFields[r+1],this.subFields[r+1]=f,this.resetAllNames(),this.arrowAnim&&this.arrowAnim.stop(!0),this.arrowAnim=new e.Anim({node:a,from:{backgroundColor:this.arrowAnimColors.from},to:{backgroundColor:this.arrowAnimColors.to},duration:1}),this.arrowAnim.on("end",function(){e.one(a).setStyle("backgroundColor","")}),this.arrowAnim.run(),this.fireUpdatedEvt()}},onDelete:function(e){e.halt();if(t.isNumber(this.options.minItems)&&this.subFields.length<=this.options.minItems)return;var n=e.target._node.parentNode,r=-1,i=n.childNodes[this.options.useButtons?1:0];for(var s=0;s<this.subFields.length;s++)if(this.subFields[s].getEl()==i){r=s;break}r!=-1&&this.removeElement(r),this.resetAllNames(),this.fireUpdatedEvt()},removeElement:function(e){var t=this.subFields[e].getEl().parentNode;this.subFields[e]=undefined,this.subFields=n.compactArray(this.subFields),t.parentNode.removeChild(t)},clear:function(e){this.setValue(t.isUndefined(this.options.value)?[]:this.options.value,e)}}),n.registerType("list",n.ListField,[{type:"string",label:"List label",name:"listLabel",value:""},{type:"type",label:"List element type",required:!0,name:"elementType"}])},"3.1.0",{requires:["inputex-field","anim"]})},"@VERSION@");
