YUI.add("inputex-form",function(e,t){YUI.add("inputex-form",function(e){var t=e.Lang,n=e.inputEx;n.Form=function(e){n.Form.superclass.constructor.call(this,e)},e.extend(n.Form,n.Group,{setOptions:function(e){n.Form.superclass.setOptions.call(this,e),this.buttons=[],this.options.buttons=e.buttons||[],this.options.action=e.action,this.options.method=e.method,this.options.className=e.className||"inputEx-Group",this.options.autocomplete=t.isUndefined(e.autocomplete)?n.browserAutocomplete:e.autocomplete===!1||e.autocomplete==="off"?!1:!0,this.options.enctype=e.enctype,e.ajax&&(this.options.ajax={},this.options.ajax.method=e.ajax.method||"POST",this.options.ajax.uri=e.ajax.uri||"default.php",this.options.ajax.callback=e.ajax.callback||{},this.options.ajax.callback.scope=e.ajax.callback&&e.ajax.callback.scope||this,this.options.ajax.showMask=t.isUndefined(e.ajax.showMask)?!1:e.ajax.showMask,this.options.ajax.contentType=e.ajax.contentType||"application/json",this.options.ajax.wrapObject=e.ajax.wrapObject),t.isFunction(e.onSubmit)&&(this.options.onSubmit=e.onSubmit)},render:function(){this.divEl=n.cn("div",{className:this.options.className}),this.options.id&&(this.divEl.id=this.options.id),this.form=n.cn("form",{method:this.options.method||"POST",action:this.options.action||"",className:this.options.className||"inputEx-Form"}),this.divEl.appendChild(this.form),this.options.enctype&&this.form.setAttribute("enctype",this.options.enctype),this.form.setAttribute("autocomplete",this.options.autocomplete?"on":"off"),this.options.formName&&(this.form.name=this.options.formName),this.renderFields(this.form),this.renderButtons(),this.options.disabled&&this.disable()},renderButtons:function(){var e,t,r,i=this.options.buttons.length;this.buttonDiv=n.cn("div",{className:"inputEx-Form-buttonBar"});for(r=0;r<i;r++){e=this.options.buttons[r];if(!e)throw new Error("inputEx.Form: One of the provided button is undefined ! (check trailing comma)");t=new n.widget.Button(e),t.render(this.buttonDiv),this.buttons.push(t)}this.buttonDiv.appendChild(n.cn("div",null,{clear:"both"})),this.form.appendChild(this.buttonDiv)},initEvents:function(){var t,r;n.Form.superclass.initEvents.call(this),this.publish("submit"),this.publish("afterValidation"),e.on("submit",function(e){e.halt(),this.fire("submit")},this.form,this);for(t=0,r=this.buttons.length;t<r;t++)this.buttons[t].on("submit",function(){this.fire("submit")},this);this.on("submit",this.options.onSubmit||this.onSubmit,this)},onSubmit:function(e){if(!this.validate())return;this.fire("afterValidation");if(this.options.ajax){this.asyncRequest();return}this.form.submit()},asyncRequest:function(){this.options.ajax.showMask&&this.showMask();var n=this.getValue(),r=t.isFunction(this.options.ajax.uri)?this.options.ajax.uri(n):this.options.ajax.uri,i=t.isFunction(this.options.ajax.method)?this.options.ajax.method(n):this.options.ajax.method,s=null,o={};if(this.options.ajax.contentType=="application/x-www-form-urlencoded"&&i!="PUT"){o["Content-Type"]="application/x-www-form-urlencoded";var u=[];for(var a in n)if(n.hasOwnProperty(a)){var f=(this.options.ajax.wrapObject?this.options.ajax.wrapObject+"[":"")+a+(this.options.ajax.wrapObject?"]":"");u.push(f+"="+window.encodeURIComponent(n[a]))}s=u.join("&")}else{o["Content-Type"]="application/json";if(i=="PUT"){var l=this.getValue(),c;this.options.ajax.wrapObject?(c={},c[this.options.ajax.wrapObject]=l):c=l,s=e.JSON.stringify(c)}else s="value="+window.encodeURIComponent(e.JSON.stringify(this.getValue()))}var h=function(){this.options.ajax.showMask&&this.hideMask(),t.isFunction(this.options.ajax.callback.success)&&this.options.ajax.callback.success.apply(this.options.ajax.callback.scope,arguments)},p=function(){this.options.ajax.showMask&&this.hideMask(),t.isFunction(this.options.ajax.callback.failure)&&this.options.ajax.callback.failure.apply(this.options.ajax.callback.scope,arguments)};e.io(r,{method:i,data:s,headers:o,on:{success:h,failure:p},context:this})},renderMask:function(){if(this.maskRendered)return;e.one(this.divEl).setStyle("position","relative"),e.UA.ie>0&&e.one(this.divEl).setStyle("zoom",1),this.formMask=n.cn("div",{className:"inputEx-Form-Mask"},{display:"none",width:this.divEl.offsetWidth+"px",height:this.divEl.offsetHeight+"px"},"<div class='inputEx-Form-Mask-bg'/><center><br/><div class='inputEx-Form-Mask-spinner'></div><br /><span>"+n.messages.ajaxWait+"</span></div>"),this.divEl.appendChild(this.formMask),this.maskRendered=!0},showMask:function(){this.renderMask(),this.toggleSelectsInIE(!1),this.formMask.style.display=""},hideMask:function(){this.toggleSelectsInIE(!0),this.formMask.style.display="none"},toggleSelectsInIE:function(t){if(!!e.UA.ie&&e.UA.ie<7){var n=t?"removeClass":"addClass",r=this;e.one(this.divEl).all("select").each(function(e){e[n]("inputEx-hidden")})}},enable:function(){n.Form.superclass.enable.call(this);for(var e=0;e<this.buttons.length;e++)this.buttons[e].enable()},disable:function(){n.Form.superclass.disable.call(this);for(var e=0;e<this.buttons.length;e++)this.buttons[e].disable()},destroy:function(){var t,r,i;e.Event.purgeElement(this.form);for(t=0,r=this.buttons.length;t<r;t++)i=this.buttons[t],i.destroy();n.Form.superclass.destroy.call(this)}}),n.registerType("form",n.Form,[{type:"list",label:"Buttons",name:"buttons",elementType:{type:"group",fields:[{label:"Label",name:"value"},{type:"select",label:"Type",name:"type",choices:[{value:"button"},{value:"submit"}]}]}}])},"3.1.0",{requires:["io-base","inputex-group","json","inputex-button"]})},"@VERSION@");
