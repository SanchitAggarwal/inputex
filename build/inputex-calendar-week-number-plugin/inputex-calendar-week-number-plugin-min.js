YUI.add("inputex-calendar-week-number-plugin",function(e,t){function r(){r.superclass.constructor.apply(this,arguments)}var n=864e5;r.NS="weekNumber",r.ATTRS={strings:{valueFn:function(){return e.Intl.get("inputex-calendar-week-number-plugin")}}},e.extend(r,e.Plugin.Base,{initializer:function(){var e=this.get("host");this._rerenderHandle=this.beforeHostMethod("_rerenderCalendarPane",this._rerenderWeekNumbers),e.get("rendered")?(this._initWeekNumbers(),e._afterDateChange()):this.afterHostMethod("renderUI",function(){this._initWeekNumbers(),e._afterDateChange()})},destructor:function(){this._rerenderHandle.detach();if(this.get("host").get("rendered")){var e=this.get("host"),t=e.get("contentBox").all(".yui3-calendar-grid");t.each(function(e){e.all(".yui3-calendar-week-number-spacer").remove(),e.all(".yui3-calendar-week-number").remove()})}},_initWeekNumbers:function(){var t=this.get("host"),n=t.get("contentBox").all(".yui3-calendar-grid");n.each(function(t){t.one(".yui3-calendar-weekdayrow").prepend(e.Node.create('<th class="yui3-calendar-week-number-spacer"></th>')),t.all(".yui3-calendar-row").each(function(e){e.prepend('<th class="yui3-calendar-week-number"></th>')})})},_rerenderWeekNumbers:function(e,t){var n=this,r=n.get("host");t.setStyle("visibility","hidden");var i=t.all(".yui3-calendar-week-number"),s=n.getWeekNumber(e,r.get("strings.first_weekday"),n.get("strings.week_one_jan_date")),o;i.each(function(){o=(s<10?"&nbsp;":"")+s,this.set("innerHTML",o),s=s%52+1})},getWeekNumber:function(e,t,r){t=t||0,r=r||1;var i=this.clearTime(e),s,o;i.getDay()===t?s=i:s=this.getFirstDayOfWeek(i,t);var u=s.getFullYear();o=new Date(s.getTime()+6*n);var a;if(u!==o.getFullYear()&&o.getDate()>=r)a=1;else{var f=this.clearTime(this.getDate(u,0,r)),l=this.getFirstDayOfWeek(f,t),c=Math.round((i.getTime()-l.getTime())/n),h=c%7,p=(c-h)/7;a=p+1}return a},clearTime:function(e){return e.setHours(12,0,0,0),e},getDate:function(e,t,n){var r=null;return typeof n=="undefined"&&(n=1),e>=100?r=new Date(e,t,n):(r=new Date,r.setFullYear(e),r.setMonth(t),r.setDate(n),r.setHours(0,0,0,0)),r},getFirstDayOfWeek:function(t,n){n=n||0;var r=t.getDay(),i=(r-n+7)%7;return e.Date.addDays(t,-i)}}),e.namespace("Plugin").CalendarWeekNumber=r},"@VERSION@",{requires:["plugin","calendar","datatype-date-math"],skinnable:!0,lang:["en","fr"]});
